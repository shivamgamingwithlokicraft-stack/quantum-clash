<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>QuantumClash 3D</title>
<link rel="icon" href="https://cdn-icons-png.flaticon.com/512/616/616408.png">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { margin:0; overflow:hidden; background:#111; font-family:Arial; }
header { position:fixed; top:0; width:100%; padding:10px; background:#0ff; text-align:center; font-weight:bold; z-index:10; }
#ui { position:fixed; top:50px; left:10px; color:#0ff; z-index:10; }
#mobile {
  position:fixed; bottom:20px; width:100%; display:flex;
  justify-content:space-around; z-index:20;
}
.btn {
  background:#0ff; color:#000; padding:14px;
  border-radius:50%; font-weight:bold;
}
</style>
</head>

<body>
<header>QuantumClash 3D</header>

<div id="ui">
  <div id="score">Score: 0</div>
  <div id="p1">Player1 Health: 100</div>
  <div id="p2">Player2 Health: 100</div>
  <div id="boss">Boss Health: 200</div>
</div>

<div id="mobile">
  <div class="btn" id="left">â—€</div>
  <div class="btn" id="shoot">ðŸ”¥</div>
  <div class="btn" id="right">â–¶</div>
</div>

<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.157/build/three.module.js';
import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.157/examples/jsm/controls/OrbitControls.js';
import { GLTFLoader } from 'https://cdn.jsdelivr.net/npm/three@0.157/examples/jsm/loaders/GLTFLoader.js';

/* ===== SCENE ===== */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x111111);

const camera = new THREE.PerspectiveCamera(70, innerWidth/innerHeight, 0.1, 1000);
camera.position.set(0,12,30);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(Math.min(devicePixelRatio,2));
document.body.appendChild(renderer.domElement);

/* ===== CONTROLS ===== */
const controls = new OrbitControls(camera, renderer.domElement);
controls.enablePan = false;
controls.enableRotate = false;
controls.target.set(0,5,0);

/* ===== LIGHTS ===== */
scene.add(new THREE.AmbientLight(0xffffff,1));
const light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(10,20,10);
scene.add(light);

/* ===== FLOOR ===== */
const floor = new THREE.Mesh(
  new THREE.PlaneGeometry(60,60),
  new THREE.MeshStandardMaterial({color:0x222222})
);
floor.rotation.x = -Math.PI/2;
scene.add(floor);

/* ===== GLOBALS ===== */
const loader = new GLTFLoader();
const mixers = [];
const bullets = [];
const enemies = [];

let player1, player2, boss;
let score=0, p1Health=100, p2Health=100, bossHealth=200;

/* ===== MODEL LOAD ===== */
const MODEL = "/assets/models/RobotExpressive.glb";

loader.load(MODEL, gltf=>{
  player1 = gltf.scene.clone();
  player2 = gltf.scene.clone();
  boss = gltf.scene.clone();

  [player1,player2,boss].forEach(m=>{
    m.scale.set(2,2,2);
    scene.add(m);
    const mix = new THREE.AnimationMixer(m);
    mix.clipAction(gltf.animations[0]).play();
    mixers.push(mix);
  });

  player1.position.set(-6,0,0);
  player2.position.set(6,0,0);
  boss.position.set(0,0,-12);
});

/* ===== BULLET ===== */
function shoot(from){
  if(!from) return;
  const b = new THREE.Mesh(
    new THREE.SphereGeometry(0.2),
    new THREE.MeshStandardMaterial({emissive:0xffff00})
  );
  b.position.copy(from.position).add(new THREE.Vector3(0,1,0));
  b.owner = from;
  scene.add(b);
  bullets.push(b);
}

/* ===== ENEMY SPAWN ===== */
setInterval(()=>{
  if(!boss) return;
  const e = boss.clone();
  e.scale.set(1.2,1.2,1.2);
  e.position.set(Math.random()*20-10,0,-25);
  scene.add(e);
  enemies.push(e);
},6000);

/* ===== BOSS AI ===== */
function bossAI(){
  if(!boss) return;
  boss.position.x = Math.sin(Date.now()*0.002)*6;
  if(Math.random()<0.01) shoot(boss);
}

/* ===== UPDATE LOOP ===== */
const clock = new THREE.Clock();

function animate(){
  requestAnimationFrame(animate);
  const dt = clock.getDelta();

  mixers.forEach(m=>m.update(dt));
  bossAI();

  bullets.forEach((b,i)=>{
    b.position.z -= 0.6;
    if(b.position.length()>80){
      scene.remove(b);
      bullets.splice(i,1);
    }
  });

  enemies.forEach((e,i)=>{
    e.position.z +=0.03;
    if(e.position.distanceTo(player1?.position||new THREE.Vector3())<1.5){
      p1Health-=10;
      scene.remove(e);
      enemies.splice(i,1);
    }
  });

  document.getElementById("score").textContent = "Score: "+score;
  document.getElementById("p1").textContent = "Player1 Health: "+p1Health;
  document.getElementById("p2").textContent = "Player2 Health: "+p2Health;
  document.getElementById("boss").textContent = "Boss Health: "+bossHealth;

  renderer.render(scene,camera);
}
animate();

/* ===== MOBILE CONTROLS ===== */
left.ontouchstart = ()=> player1.position.x -=0.5;
right.ontouchstart = ()=> player1.position.x +=0.5;
shoot.ontouchstart = ()=> shoot(player1);

/* ===== RESIZE ===== */
addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
